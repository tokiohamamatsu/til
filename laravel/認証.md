# 認証

## 準備

以下のコードを実行する

- `php artisan make:auth` ルートとビューが生成される
- `php artisan migrate` 認証用のテーブルを作成
コントローラとモデル、マイグレーションは最初からある

## ログインの対象カラムの変更

デフォルトでemailを対象カラムとされている、担当者CDを対象カラムにするためにはLoginController.phpに下記を追加する

```php
public function username()
    {
        return '担当者CD';
    }
```

## ログインフォームのカスタマイズ

login.blade.phpの中のemailを担当者CDに変更する

```php
<div class="form-group row">
    <label for="担当者CD" class="col-md-4 col-form-label text-md-right">{{ __('担当者CD') }}</label>

    <div class="col-md-6">
        <input id="担当社CD" type="text" class="form-control @error('担当者CD') is-invalid @enderror" name="担当社CD" value="{{ old('担当者CD') }}" required autocomplete="担当者CD" autofocus>
        @error('担当者CD')
        <span class="invalid-feedback" role="alert">
            <strong>{{ $message }}</strong>
        </span>
        @enderror
    </div>
</div>
```

## 認証テーブルの変更

デフォルトでusersテーブルが認証テーブルとなっている、usersテーブルではなくM担当者テーブルを使いたい場合はcongig/auth.phpを下記のように変更する 

```php
'providers' => [
        'users' => [
            'driver' => 'eloquent',
            'model' => App\Mstaff_model::class,
        ],
```

Mstaff_modelはmodelクラスではなくAuthenticatableクラスを継承する

```php
use Illuminate\Database\Eloquent\Model;
use Illuminate\Foundation\Auth\User as Authenticatable;

class Mstaff_model extends Authenticatable
```

### 参考

[Laravel 5\.5 の認証機能とそのカスタマイズ \- Qiita](https://qiita.com/naga3/items/4f3defde59b31a1a797e#user%E3%83%A2%E3%83%87%E3%83%AB%E4%BB%A5%E5%A4%96%E3%82%92%E8%AA%8D%E8%A8%BC%E3%81%AB%E4%BD%BF%E3%81%86)

[Laravelの認証機能をカスタマイズする \- Qiita](https://qiita.com/t-iguchi/items/446a3958bf5a27c91fd1)

[Laravel 5\.6 で、userテーブル以外で認証を行う \- uemonのプログラムの忘備録](http://fushigi.hatenadiary.com/entry/2018/03/29/163154)

[Laravelの認証を別テーブル\(モデル\)に変更してカスタマイズする \| あたまカチコチブログ](https://enginiah.com/laravel-auth-customize/)