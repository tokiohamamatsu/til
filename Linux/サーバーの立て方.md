# サーバーの立て方

## Centosのインストール

1. BootからUSBを読み込む
2. Install CentOS 7を選択
3. 言語を選択
4. インストール先やソフトウェアの選択などを設定する
5. rootパスワードを設定する
6. ユーザーを管理者で作成する
7. インストールが完了すると再起動され、ログイン画面になる

### 参考

[CentOS 7 をインストール Linuxを始めるにはインストールからがお勧め \- レムシステム エンジニアブログ](https://www.rem-system.com/centos-install/)

※　`su -`でrootユーザーに切り替えられる

[Linuxでrootユーザーへの切替えやroot権限で実行する方法 \| mzgkworks\.com](http://mzgkworks.com/post/linux-su-sudo/)

## 自動アップデート環境を作成する

1. rootアカウントで`yum update`コマンドを使いアップデートする。
2. `yum intall yum-cron.noarch`でyum-croｎをインストールする。
3. etc/yum/yum-cron.confをコピーし、設定する

### 参考

[【初心者でもわかる】yumコマンドの使い方とリポジトリの追加方法](https://eng-entrance.com/linux-package-yum)

[yum\-cronを使おう \- Qiita](https://qiita.com/shimano_equipped/items/ff65ace63399435107f0)

[yumを自動で更新チェックする、自動で更新する \- \[yum/Linux \[Red Hatなど\]\] ぺんたん info](https://pentan.info/server/linux/yum_updatesd.html)

[ｖｉエディタの使い方](https://prev.net-newbie.com/linux/commands/vi.html)

## sshdの設定

1. ipコマンドでipアドレスを確認
2. sshd_configをを確認する
3. systemctl start sshd.serviceでサービスを開始する
4. ファイアウォールの確認
5. ユーザの作成　※rootでの接続を禁止にした場合
6. クライアント側で接続テスト

### 参考

[【初心者向け】Linux PCのIPアドレスを確認する方法まとめ \| LFI](https://linuxfan.info/ip-address)

[Linux\(CentOS7\)でSSHを利用する。 \- Qiita](https://qiita.com/sango/items/816136188387221f05b3)

[CentOS で root の SSH ログインを制限する（PermitRootLogin=yes） \| TURNING POINT](https://turningp.jp/server-client/linux/ssh-permitrootlogin)

##  apacheのインストール

1. `yum install httpd`でapacheをインストール
2. `systemctl status httpd`でapacheが起動しているか確認する。
3. `firrewall-cmd --add-service=http --zone=public --permanent`
でfirewallにhttpd(80番ポート)への通信を許可する。
4. `http://ipアドレス`でページを表示する。

### 参考

[Apache httpd 2\.4 を CentOS 7 に yum でインストールする手順 \| WEB ARCH LABO](https://weblabo.oscasierra.net/apache-installing-apache24-yum-centos7-1/)

[Apacheの起動しているかの確認方法と起動、再起動、終了のコマンド \| エス技研](https://blog.s-giken.net/)

## phpのインストール

1. EPELリポジトリをインストールする。
2. Remiリポジトリをインストールする。
3. phpをインストールする。
4. phpinfo()を表示させる。

### 参考

[Centos5,6,7にEPEL/REMIのyumリポジトリの追加をする。 \- Qiita](https://qiita.com/chidakiyo/items/3b81a442dda34d439b42)

[CentOS7にPHP7\.3をインストールする \- suzu6](https://www.suzu6.net/posts/152-centos7-php-73/)

[Linux\(CentOS7\)でWebサーバーを構築する。 \-php導入編\- \- Qiita](https://qiita.com/sango/items/a08c5b04df7125aaaad3)

## mariadbのインストール

1. `yum install mariadb mariadb-server`でmariadbをインストールする。
2. my.cnfに文字コードの設定を記述する。

### 参考

[CentOS7 MariaDB\(MySQL\)インストール手順 \- Qiita](https://qiita.com/iamdaisuke/items/adc561e057a69afebad8)

## Gitlab接続
1. Gitをインストール
2. sshキーを格納するフォルダを作成
3. `ssh-keygen`でsshキーを作成
4. Gitlabに公開鍵を登録
5. cinfigファイルを作成
6. 接続テスト
   
### 参考

[Git \- Gitのインストール](https://git-scm.com/book/ja/v2/%E4%BD%BF%E3%81%84%E5%A7%8B%E3%82%81%E3%82%8B-Git%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB)

[GitLabにSSHで接続するまでの手順 \- Qiita](https://qiita.com/kyamawaki/items/07fb3332cf3c2f47728a)

[【GitLab】SSH接続をテストする \- Qiita](https://qiita.com/CUTBOSS/items/c0717946fd1787073704)

[Linux, macOS, or Unix 上で AWS CodeCommit リポジトリに SSH 接続するために必要なセットアップ手順 \- AWS CodeCommit](https://docs.aws.amazon.com/ja_jp/codecommit/latest/userguide/setting-up-ssh-unixes.html)

[ディレクトリを作成する！mkdirコマンドの詳しいまとめ【Linuxコマンド集】](https://eng-entrance.com/linux-command-mkdir)

## gitlabのリポジトリを取得

1. gitlabの取得したいプロジェクトのClone with SSHを取得
2. `git clone`でリポジトリを複製する

### 参考

[Git \- Git リポジトリの取得](https://git-scm.com/book/ja/v2/Git-%E3%81%AE%E5%9F%BA%E6%9C%AC-Git-%E3%83%AA%E3%83%9D%E3%82%B8%E3%83%88%E3%83%AA%E3%81%AE%E5%8F%96%E5%BE%97)

[コマンドラインでGitを使い始める\| GitLab](https://docs.gitlab.com/ee/gitlab-basics/start-using-git.html#add-a-remote-repository)

## mariadb接続

1. 外部ホスト用ユーザーを作成
2. 使用するポートを開放
3. 実際にログインする

### 参考

[CentOS7にMariaDBをインストールして外部ホストから接続する方法 \- Qiita](https://qiita.com/NoriIka/items/cccaf60eacee6fb6951b)

[valid,invalid: [MySQL] 外部から接続するのに失敗しまくった（ファイアウォール、my\.cnf、権限）](http://ohbarye.blogspot.com/2014/07/mysql.html)

## 外部のDBサーバーに接続

※HeidiSQLを使う

1. HeidiSQLのネットワーク種別をssh tunnelにする
2. ipアドレスとユーザー、パスワードを入力する。(このDBサーバーを使っているプロジェクトの.envファイルを見る)
3. sshトンネルにplink.exeのパスを入力する。
4. sshホストとポートを指定する。
5. ユーザー名を指定する
6. 秘密鍵ファイルに秘密鍵のパスを入力する。(鍵がなければPuTTYgenで鍵を作成する。)
7. 実際に接続する。

### 参考

[HeidiSQLでWindowsからMySQLサーバにSSH経由で接続する \| 俺的備忘録 〜なんかいろいろ〜](https://orebibou.com/2015/01/heidisql%E3%81%A7windows%E3%81%8B%E3%82%89mysql%E3%82%B5%E3%83%BC%E3%83%90%E3%81%ABssh%E7%B5%8C%E7%94%B1%E3%81%A7%E6%8E%A5%E7%B6%9A%E3%81%99%E3%82%8B/)

[PuTTYgenで公開鍵/秘密鍵を作成する \- WinSCP Wiki \- WinSCP \- OSDN](https://ja.osdn.net/projects/winscp/wiki/ui_puttygen)