# 2019-11

## 01

### [phpの圧縮について \- Qiita](https://qiita.com/sota/items/07e8ad480556c9a43d77)

例

圧縮前

```php
    protected function _getUserList() {

        $userList = array();

        $key = __METHOD__;
        $cacheRes = Cache::read($key);
        if ( $cacheRes ) {
            $userList = $cacheRes;
            return $userList;
        }

        $userList = UserDb::selectUserList()
        $ret = Cache::save($key, $userList , 60);
        return $userList;
    }

# 保存内容は利用者に任せているのでバカでかいarrayとかが保存されがち
```

圧縮後

```php
   protected function _getUserList() {

        $userList = array();

        $key = __METHOD__;
        $cacheRes = Cache::read($key);
        if ( $cacheRes ) {
            $userList = json_decode(gzuncompress($cacheRes), true);
            return $userList;
        }

        $userList = UserDb::selectUserList()
        $comp = gzcompress(json_encode($userList))
        $ret = Cache::save($key, $comp, 60);
        return $userList;
    }
```

gzuncompressとは

圧縮された文字列を解凍する
[PHP: gzuncompress \- Manual](https://www.php.net/manual/ja/function.gzuncompress.php)


gzcompressとは

文字列を圧縮する

[PHP: gzcompress \- Manual](https://www.php.net/manual/ja/function.gzcompress.php)


圧縮と解凍はこうやるのか

## 05

### [firebaseのPromise内でthisを参照する方法 \- Qiita](https://qiita.com/noby111/items/c11c4dad5ed69e93a4d1)

firebaseとは

>Firebaseは、2011年にFirebase、Inc\.によって開発され、2014年にGoogleに買収されたモバイルおよびWebアプリケーション開発プラットフォーム
>[firebase - Google 検索](https://www.google.com/search?q=firebase&oq=firebase&aqs=chrome..69i57j0l5.3311j0j8&sourceid=chrome&ie=UTF-8)

Vue.jsのcomponent内でfirebaseのクエリを利用し、その結果をdata内に格納したいが、thenの中でthisを参照し、markerプロパティに代入したいがthisはundefinedといわれる

```js
export default {
  data () {
    return {
      markers: [],
    }
  },

  methods:{
    updateMarkers() {
      var db = firebase.firestore()
      var query = db.collection('markers')

      query.get()
        .then(function(snapshot){
          var markers = []
          snapshot.forEach(function(doc) {
            var marker = { position: doc.data().latLng }
            markers.push(marker)
          })
          this.markers = markers
        })
    },
  }
}
```

thisを一旦ローカル変数に格納し、promise内で参照させるようにする


```js
export default {
  data () {
    return {
      markers: [],
    }
  },

  methods:{
    updateMarkers() {
      var db = firebase.firestore()
      var query = db.collection('markers')
      var self = this

      query.get()
        .then(function(snapshot){
          var markers = []
          snapshot.forEach(function(doc) {
            var marker = { position: doc.data().latLng }
            markers.push(marker)
          })
          self.markers = markers 
        })
    },
  }
}
```

thisを一旦ローカル変数にに格納する技術は汎用性がありそう