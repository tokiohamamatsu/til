# 2019-11

## 01

### [phpの圧縮について \- Qiita](https://qiita.com/sota/items/07e8ad480556c9a43d77)

例

圧縮前

```php
    protected function _getUserList() {

        $userList = array();

        $key = __METHOD__;
        $cacheRes = Cache::read($key);
        if ( $cacheRes ) {
            $userList = $cacheRes;
            return $userList;
        }

        $userList = UserDb::selectUserList()
        $ret = Cache::save($key, $userList , 60);
        return $userList;
    }

# 保存内容は利用者に任せているのでバカでかいarrayとかが保存されがち
```

圧縮後

```php
   protected function _getUserList() {

        $userList = array();

        $key = __METHOD__;
        $cacheRes = Cache::read($key);
        if ( $cacheRes ) {
            $userList = json_decode(gzuncompress($cacheRes), true);
            return $userList;
        }

        $userList = UserDb::selectUserList()
        $comp = gzcompress(json_encode($userList))
        $ret = Cache::save($key, $comp, 60);
        return $userList;
    }
```

gzuncompressとは

圧縮された文字列を解凍する
[PHP: gzuncompress \- Manual](https://www.php.net/manual/ja/function.gzuncompress.php)


gzcompressとは

文字列を圧縮する

[PHP: gzcompress \- Manual](https://www.php.net/manual/ja/function.gzcompress.php)


圧縮と解凍はこうやるのか

## 05

### [firebaseのPromise内でthisを参照する方法 \- Qiita](https://qiita.com/noby111/items/c11c4dad5ed69e93a4d1)

firebaseとは

>Firebaseは、2011年にFirebase、Inc\.によって開発され、2014年にGoogleに買収されたモバイルおよびWebアプリケーション開発プラットフォーム
>[firebase - Google 検索](https://www.google.com/search?q=firebase&oq=firebase&aqs=chrome..69i57j0l5.3311j0j8&sourceid=chrome&ie=UTF-8)

Vue.jsのcomponent内でfirebaseのクエリを利用し、その結果をdata内に格納したいが、thenの中でthisを参照し、markerプロパティに代入したいがthisはundefinedといわれる

```js
export default {
  data () {
    return {
      markers: [],
    }
  },

  methods:{
    updateMarkers() {
      var db = firebase.firestore()
      var query = db.collection('markers')

      query.get()
        .then(function(snapshot){
          var markers = []
          snapshot.forEach(function(doc) {
            var marker = { position: doc.data().latLng }
            markers.push(marker)
          })
          this.markers = markers
        })
    },
  }
}
```

thisを一旦ローカル変数に格納し、promise内で参照させるようにする


```js
export default {
  data () {
    return {
      markers: [],
    }
  },

  methods:{
    updateMarkers() {
      var db = firebase.firestore()
      var query = db.collection('markers')
      var self = this

      query.get()
        .then(function(snapshot){
          var markers = []
          snapshot.forEach(function(doc) {
            var marker = { position: doc.data().latLng }
            markers.push(marker)
          })
          self.markers = markers 
        })
    },
  }
}
```

thisを一旦ローカル変数にに格納する技術は汎用性がありそう

## 06

### [JavaScriptのthisのスコープについて調べた \- Qiita](https://qiita.com/infr_0329/items/0b5f52eca738a6814c1a)

- 関数からの呼び出しの場合はthisはグローバルオブジェクトを参照している

```js
var test = 'nogi';

function myThis(){
  console.log(this);  // Window
  this.test = 'hoge';
}

myThis();
console.log(test);  // hoge
```

- メソッドからの呼び出しの場合はthisは属しているオブジェクトを参照する

```js
var test = 'yamada';

var myobj = {  
  test: 'taro',  
  myThis: function(){
    console.log(this);   // {test: "taro", myThis: ƒ}
    this.test = 'hanako';
  }
};

myobj.myThis();
console.log(myobj.test); // hanako
console.log(test); // yamada
```

- クラスからの呼び出しの場合はthisはプロパティもメソッドも属しているクラスを参照する


```js
var test = 'yamada';

class myClass{
  constructor(){
    this.test = 'taro';
    console.log(this); // myClass {test: "taro"}
  }

  myThis(){
    console.log(this);  // myClass {test: "taro"}
  }
}

var myobj = new myClass();
myobj.myThis();
console.log(test);  // yamada
```

しかし、クラス内に関数を定義するとthisはundefinedになる

- アロー関数からの呼び出しの場合はメソッドを呼び出しているオブジェクトを参照する

```js
var test = 'yamada';

var myobj = {
  test: 'taro',  
  myThis: function(){
    this.test = 'hanako';

    var arrow1 = function (){
      console.log(this.test);  // yamada
    }

    var arrow2 = () =>{
      console.log(this.test);  // hanako
    }

    arrow1();
    arrow2();
  }
};

myobj.myThis();
```

なぜ、クラスに関数を定義するとthisはundefinedになるのか？

## 07

### [[Vue] スライダーで割合を調整するUIを作成する \- Qiita](https://qiita.com/e_q/items/b3cdba2f532fbc298c8d)

vue-slider-componentとは

[カスタマイズ性の高いスライダー「vue\-slider\-component」の使い方 \| カバの樹](https://www.kabanoki.net/4621/)

```html
<div id="app">
    <button id="add" v-on:click="add">add</button>
  
    <button id="del" v-on:click="del">del</button><br><br>
    <vue-slider ref="slider" v-model="dots" :process="processFunc" :enable-cross="false">
    </vue-slider>
    <table>
      <th>item</th>
      <th>value</th>
      <tr v-for="(item, index) in items">
        <td> {{item}} </td>
        <td> {{getDots(index)}} </td>
    </table>
    
</div>
```

```js
new Vue({
  el: '#app',
  components: { "vue-slider": window['vue-slider-component'] },
  data: () => {
    return {
      items: ["item_0", "item_1", "item_2"],
      dots: [33,66],
      color:["red", "orange", "yellow", "green", "blue"],
      processFunc: dotsPos => {
        var array = [];
        if (dotsPos.length < 1) {
          return array;
        }

        var color = ["red", "orange", "yellow", "green", "blue"];

        array[0] = [0, dotsPos[0], { backgroundColor : color[0]}];
        for (var i = 1; i < dotsPos.length; i++) {
          array[i] = [dotsPos[i - 1], dotsPos[i], { backgroundColor : color[i % 5]}];
        }
        array[dotsPos.length] = [dotsPos[dotsPos.length - 1], 100, { backgroundColor : color[dotsPos.length % 5], disabled:true}];
        return array;
      },
    }
  },
  methods: {
    add: function () {
      this.items.push("item_" + this.items.length);
      this.setDots();
    },
    del: function() {
      this.items.pop();
      this.setDots();
    },
    setDots: function() {
      this.dots = [];
      if (this.items.length > 1) {
        var x = 100 / this.items.length;
        for (var i = 0; i < this.items.length - 1; i++) {
          this.dots.push(Math.floor(x * (i + 1)));
        }
        this.$refs.slider.setValue(this.dots);
      }
    },
    getDots: function(index) {
      if (this.items.length == 1) {
        return 100;
      } else if (index == 0) {
        return Array.isArray(this.dots) ? this.dots[0] : this.dots;
      } else if (index == this.items.length - 1) {
        return 100 - (Array.isArray(this.dots) ? this.dots[index - 1] : this.dots);
      }

      return this.dots[index] - this.dots[index - 1];
    }
  },
});
```

processFuncで返す配列が、各バーの始点・終点で、引数に点の位置が配列で入る

ツールチップ

```js
<template>
  <main id="app"
      <vue-slider ref="slider" v-model="dots" tooltip="none" :process="processFunc" :enable-cross="false">
        <template v-slot:process="{ start, end, style, index }">
          <div class="vue-slider-process" :style="style">
            <div :class="[
              'merge-tooltip',
              'vue-slider-dot-tooltip-inner',
              'vue-slider-dot-tooltip-inner-top',
            ]">
              {{ getRaito(index) }}
            </div>
          </div>
        </template>
      </vue-slider>
  </main>
</template>
<style>
  .merge-tooltip {
    position: absolute;
    left: 50%;
    bottom: 100%;
    transform: translate(-50%, -15px);
  }
</style>
```

ツールチップはこう作るんだな

## 08

### [php7\.0から使える「宇宙船演算子」が名前がかっこいいw \- Qiita](https://qiita.com/a-nishimura/items/2d74f12cf1fc219827f7)

宇宙船演算子とは

2つの式を比較するために使うもの

```php
echo $a <=> $b;
```

$aが右の$bより大きければ1を返し、等しい場合は0、小さければ-1を返す

``` php
// 整数値
var_dump(1 <=> 1); // 0
var_dump(1 <=> 2); // -1
var_dump(2 <=> 1); // 1

// 浮動小数点
var_dump(1.5 <=> 1.5); // 0
var_dump(1.5 <=> 1.6); // -1
var_dump(2.1 <=> 1.5); // 1

// 文字列
var_dump("a" <=> "a"); // 0
var_dump("a" <=> "b"); // -1
var_dump("b" <=> "a"); // 1
```

[PHP: 新機能 \- Manual](https://www.php.net/manual/ja/migration70.new-features.php#migration70.new-features.spaceship-op)

可読性が下がりそう

## 11

### [【初心者】JavaScript　ファイル分割／相対パス／パッケージ【備忘録１３】 \- Qiita](https://qiita.com/charlie19919425/items/ed3fe41fb89eafffa264)


ファイルの分割

エクスポート

```js
class Animal{...
}

export default Animal;
//クラス定義の後でexportを書く。この形はデフォルトエクスポートと呼ばれる。
```

クラス名のところを定数名に変えれば値をエクスポートできる

デフォルトエクスポートは1つのファイルに1つしか使用できない。

複数エクスポートしたい場合

```js
export {dog};
//定数名の間を[,]で区切ると複数もOK！ [default]不要なので気を付ける！

import {dog} from "./dogData";
```

インポート

```js
//ファイルの一番先頭に書く。
inport Animal from "./animal";

//一番はじめのAnimalはクラス名、語尾のanimalはファイル名。
```

相対パス

例
srcファイルにdataファイル、classファイル＜script.jp＞が存在。
dataファイル⇒dogData.js
classファイル⇒dog.js

例1 scriptをdogData
例2 dogDataをdogへ

```js
//例１
import {dog1,dog2} from "./data/dogData";

//例２
import Dog from "../class/dog"
//　　　　　　　　↑一つ上の階層に行く場合は ../
```


パッケージ

例 chalk:コンソールの文字に色を付ける

```js
import chalk from"chalk";
//クラスの文頭に書く。

console.log(chalk.yellow("Hello!"));
//文字が黄色に！
console.log(chalk.bgCyan("Hello!"));
//文字の背景が水色に！
```

例 readline-sync:コンソールに値を入力できる 質問文->入力->出力の形ができる

```js
import readlineSync from "readline-sync";

const name = readlineSync.question("名前を入力してください:");
//年齢など、整数を入力してほしいときは、readlineSync.questionInt 

console.log(`${name}です。`);
```

エクスポートとインポートの設定はこうやるんだ

## 12

### [ES（ECMAScript）とは？jsがブラウザによって動いたり動かなかったりするのはなぜ？ \- Qiita](https://qiita.com/minato-naka/items/73b9d531c871d98a3f22)

ESとはjavascriptの標準規格のこと、jsには元々標準規格がなく、各ブラウザで仕様の違いがあった。ECMA internationalという団体により、jsの標準規格が作成され、そのES仕様に従い、各ブラウザベンダーがブラウザに機能を実装する

ほぼ全部のブラウザで動くESバージョンはES5で、現在標準になっているのはES6
それ以降は毎年新バージョンがリリースされ、年号をバージョン名としている。

バージョンの違い

アロー関数

ES5

```js
var arrow = function arrow() {
  return 'アロー関数';
};
```

ES6

```js
var arrow = () => {
    return 'アロー関数';
};
```

分割代入

ES5

```js
var firstName = '田中',
    lastName = '一郎';
```

しかし、ES最新バージョンがリリースされても、全てのブラウザで最新ES機能を使えるわけではない、ChromeやFireFox、safariなどは基本的にES6以上に対応しているが、IE(インターネットエクスプローラー)はES5までしか対応していない。

ES6をIEで使うにはpolyfillやbabelなどのツールを使い対応する

使い方 https://qiita.com/minato-naka/items/a2645aeb158662a9f0e9

IEはなぜES6に対応してないの?

## 13

### [関数でも、文字の置換に参照記号を使えることを忘れていないだろうか… \- Qiita](https://qiita.com/BRSF/items/9b4c678129f7860b00b7)

php

phpには正規表現を用いた関数としてpreg_matchやpreg_replaceなどがある

```php
preg_match(パターン,対象文字列) //検索に用います
preg_replace(パターン,置換文字,対象文字列) //置換に用います
```

preg_replace関数は参照記号$nを使うことができる

例

```php
$ary_addr = [
"兵庫県尼崎市東七松町１丁目２３−１",
"兵庫県西宮市六湛寺町１０の３",
"兵庫県宝塚市東洋町１番１"
];

$addr = preg_replace("/(\d+)の(\d+)/u",$1-$2,$addr);
```

置換元のパターンは置換させたくないパターンを()で囲み、そして置換先の文字列に合わせ、グループ化記号を用いた個数だけを参照記号`$1,$2,$3,`と設定していく

住所の`xxのxx`を`xx-xx`に置換

```php
$addr = preg_replace("/(\d+)の(\d+)/u",$1-$2,$addr);
```

パターンマッチングに用いる`()`はパターンの用いる記号なので、置換したい場所と区別できない場合がある。その場合は参照記号を飛ばして対応する

住所の`xxのxx`と`xx番地xx`を`xx-xx`に置換

```php
$addr = preg_replace("/(\d+)(番地|の)(\d+)/u",$1-$3,$addr);
```

$2は置換対象となるので、参照記号を表記せず、置換したい文字をそのまま記述する

数字を半角に統一し、`xx番`,`xx番地`の表記を数値だけにする場合

```php
//市役所の住所録を格納
$ary_addr = [
"兵庫県尼崎市東七松町１丁目２３−１",
"兵庫県西宮市六湛寺町１０の３",
"兵庫県宝塚市東洋町１番１号"
];

//※配列の各値に対し、処理を行う。なお、ジェネレータの方が速いです
array_walk($ary_addr,function(&addr){
    //複数繰り返しに対応させる
    $addr = mb_convert_kana($addr,"n"); //数字を半角に
    //「xxのxx」などがなくなるように繰り返す
    while(preg_match("/\d+(番地?|の)\d+/u",$addr) != false){
         $addr = preg_replace("/(\d+)(番地?|の)(\d+)/u","$1-$3",$addr);
    }
    $addr = preg_replace("/(\d+)(番地?|号)/u","$1",$addr);
});
var_dump($ary_addr);
/*以下のように置換されていきます
兵庫県尼崎市東七松町1丁目23−1",
兵庫県西宮市六湛寺町10-3",
兵庫県宝塚市東洋町1-1"
*/
```

javascriptの場合

置き換え文字をダブルクォートで囲まないとエラーになる

```js
  let str = "11の3";
   str = str.replace(/(\d+)(の|番地?)(\d+)/g,"$1-$3");
   console.log(str); //11-3
```

置換はこうするんだな

## 14

### [JavaScriptで取得してきたDOMにイベントをトリガーするワンライナー \- Qiita](https://qiita.com/hyakt/items/883b40f8cdb3f6e92db8)

取得した一つ目の要素に対し実行

```js
document.querySelector('.className').dispatchEvent(new Event('mouseover', { 'bubbles': true }));
```

取得した全ての要素に対し実行

```js
document.querySelectorAll('.className').forEach(e => {e.dispatchEvent(new Event('mouseover', { 'bubbles': true }))});
```

querySelectorメソッドは指定したセレクターまたはセレクターのグループに一致する最初のElementを返す、見つからない場合はnullを返す

querySelectorAllメソッドは指定したセレクターに一致する全ての要素のリストを返す
[Document\.querySelector\(\) \- Web API \| MDN](https://developer.mozilla.org/ja/docs/Web/API/Document/querySelector)

bubblesとは?

DOMを通してバブルアップのイベント伝搬か否かを調べる
[\.bubbles \| JavaScript 日本語リファレンス \| js STUDIO](http://js.studio-kingdom.com/javascript/event/bubbles)

## 15

### [JavaScriptのimport文を使ってみた \- Qiita](https://qiita.com/TakamiChie/items/4d92c7e80a9d4cce0178)

インポートしたいjavascriptのメソッドおよびクラスは、必ずexport句が必要

```js
export class A {
  constructor() {
    this.current = new B();
  }
}

class B {
}
```

クラス名の前にexportと書く。その中に使われるメソッドなどにはexportは必要ない

上記のようなスクリプトは以下のようにインポートできる

```js
import {A} from './importable.js';

let a = new A();
```

inport文を使うときは、import文を使うjavascriptをHTMLから飛び出すときに`<script type="mobule">`と`type="mobule"`を追記する

```html
<!DOCTYPE html>
<html>
<body>
  <!-- ... -->
  <script src="index.js" type="module"></script>
</body>
</html>
```

import文はローカル環境では動作しない。オフライン環境で動作を確認するにはサーバーを立てる必要がある。

import文で呼び出されたモジュールおよび`type=mobule`属性を指定したスクリプトは強制的にstrictモードになり、変数の制限は必須となる。

phpのビルドインウェブサーバー機能を使えばサーバーを立てることができる
https://www.php.net/manual/ja/features.commandline.webserver.php

>とりあえずプロジェクトのフォルダでおもむろにphp \-S 127\.0\.0\.1:8080などとすると、とりあえずそのフォルダをドキュメントルートとした簡易サーバが立ち上がるので、非常に便利です。PHPコードなんか一行も書いてないのですが。
>[JavaScriptのimport文を使ってみた - Qiita](https://qiita.com/TakamiChie/items/4d92c7e80a9d4cce0178)